graph TB
    %% Client Layer - top center
    HTTP[HTTP Client<br/>Go Backend]
    
    %% API Layer - top center
    Routes[API Routes<br/>FastAPI Endpoints]
    CORS[CORS Middleware]
    
    subgraph Business["Business Logic Layer"]
        SearchLogic[Search Logic<br/>Semantic Search]
        RecQuestLogic[Quest Recommendation<br/>Content-Based BERT]
        RecUserLogic[User Recommendation<br/>Profile Similarity]
        EmbeddingService[Embedding Service<br/>BERT Encoding]
    end
    
    subgraph Storage["Storage Layer"]
        InMemoryCache[In-Memory Cache<br/>app.state]
        SQLiteStorage[SQLite Storage<br/>Persistent]
    end
    
    subgraph ML["ML Model Layer"]
        BERTModel[BERT Model<br/>sentence-transformers]
        NumPy[NumPy<br/>Vector Operations]
    end
    
    subgraph Data["Data Models"]
        QuestModel[Quest Models<br/>Pydantic]
        UserModel[User Models<br/>Pydantic]
    end
    
    %% Client to API
    HTTP -->|HTTP Requests| Routes
    Routes -.->|Uses| CORS
    
    %% API to Business
    Routes -->|Calls| SearchLogic
    Routes -->|Calls| RecQuestLogic
    Routes -->|Calls| RecUserLogic
    
    %% Business internal
    SearchLogic -->|Uses| EmbeddingService
    RecQuestLogic -->|Uses| EmbeddingService
    RecUserLogic -->|Uses| EmbeddingService
    
    %% Business to Storage
    SearchLogic -->|Reads| InMemoryCache
    RecQuestLogic -->|Reads| InMemoryCache
    RecUserLogic -->|Reads| InMemoryCache
    EmbeddingService -->|Writes| InMemoryCache
    
    %% EmbeddingService to ML
    EmbeddingService -->|Uses| BERTModel
    EmbeddingService -->|Uses| NumPy
    BERTModel -->|Uses| NumPy
    
    %% Storage internal
    InMemoryCache -.->|Syncs| SQLiteStorage
    SQLiteStorage -->|Loads| InMemoryCache
    
    %% Storage to Data
    SQLiteStorage -->|Stores| QuestModel
    SQLiteStorage -->|Stores| UserModel
    
    style Business fill:#fff4e1,stroke:#f5a623,stroke-width:2px
    style Storage fill:#ffe1f5,stroke:#d0021b,stroke-width:2px
    style ML fill:#f5e1ff,stroke:#9013fe,stroke-width:2px
    style Data fill:#e1ffe1,stroke:#7ed321,stroke-width:2px
    style HTTP fill:#f0f0f0,stroke:#666666,stroke-width:2px
    style Routes fill:#e1f5ff,stroke:#4a90e2,stroke-width:2px
    style CORS fill:#e1f5ff,stroke:#4a90e2,stroke-width:2px
